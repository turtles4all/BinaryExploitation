#!/usr/bin/env python

import socket

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
connect_to = ("cyberstakes2017.hackcenter.com", 42137)

s.connect(connect_to)
b_size = 2024
buff = s.recv(b_size)

print(buff)

to_decrypt = buff.split(": ")[1]
print("Encrypted: \""+to_decrypt+"\"")
cal = "Here is your encryption: "

print(s.recv(b_size))
pattern = "ABCDEFGHIJKLMNOPQRSTUVWXYZ"
pattern += pattern.lower()
pattern += "0123456789"
pattern_sent = pattern[0:len(to_decrypt)]+"\n"

s.send(pattern_sent)
pattern_sent = pattern_sent.strip("\n")
print("Sent pattern: \""+pattern_sent+"\"")
patt_returned = str(s.recv(b_size).split(": ")[1])
print("Returned pattern: \""+patt_returned+"\"")
s.close()

# start unscrambling
y = 0
decrypted = ""
for x in pattern_sent:
    loc = patt_returned.find(x)
    decrypted += to_decrypt[loc]
    print(decrypted)
    y += 1
print("Decrypted: \""+decrypted+"\"")
exit()
