#include <stdio.h>
#include <stdint.h>
#include <string.h>
#include <stdlib.h>
#include <fcntl.h>
#include <sys/stat.h>

int str_equal(char * a, char * b){
  size_t i = 0;
  while(a[i] != 0 && b[i] != 0){
    if(a[i] != b[i]){
      return 0;
    }
    i++;
  }
  //Make sure both ended at same time
  if(a[i] == 0 && b[i] == 0){
    return 1;
  }
  return 0;
}

int check_equal(char* a, char* b){
    int i, r = 1;
    for(i = 0; i < 0x10000000; i++){
      r &= str_equal(a, b);
    }
    return r;
}

int main(int argc, char ** argv){
  //Make sure user input is there
  if(argc != 2){
    fprintf(stderr, "Please call in format %s password\n", argv[0]);
    exit(-1);
  }

  //Get password
  int pword_file = open("./password", O_RDONLY);
  if(pword_file < 0){
    fprintf(stderr, "Unable to find password file. Tell admin\n");
    exit(-1);
  }
  struct stat st;
  fstat(pword_file, &st);
  int size = st.st_size;
  char pword[size];
  int res = read(pword_file, pword, size);
  if(size <= 0){
    fprintf(stderr, "Password file read error. Tell admin\n");
    exit(-1);
  }
  pword[size-1] = '\0';

  printf("Finished loading everything. Time to do a really good compare!!!!\n");
  if(check_equal(pword, argv[1])){
    printf("win\n");
  }else{
    printf("fail\n");
  }

  return 0;
}
